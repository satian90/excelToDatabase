







<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication1._Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Data from .xls to sql</title>
    <style type="text/css">
        #form1
        {
            height: 202px;
        }
        #File1
        {
            width: 229px;
            margin-left: 81px;
        }
    </style>

    <script language="javascript" type="text/javascript">
// <!CDATA[

// ]]>
    </script>
</head>
<body>
    <form id="form1" runat="server">
    <div>
          
        <p style="height: 38px">
            <asp:Label ID="Label1" runat="server" Text="Select File: "> </asp:Label>
            <asp:FileUpload ID="FileUpload1" runat="server" style="margin-left: 86px" />
        </p>
        <p style="height: 54px">
            <asp:Label ID="Label2" runat="server" 
                Text="Enter Sheet Name:"></asp:Label>
            <asp:TextBox ID="txtSheetname" runat="server" style="margin-left: 34px" 
                Width="376px"></asp:TextBox>
                
                 
        </p>
        
                   
   

            <p style="height: 70px">
        <asp:Label ID="Label3" runat="server" Text="Select Table:"></asp:Label>
                <asp:DropDownList ID="DropDownList1" runat="server" Height="21px" 
                    style="margin-left: 70px" Width="380px">
                    <asp:ListItem>temp_prac_data_from_excel</asp:ListItem>
                    <asp:ListItem>randomTable1</asp:ListItem>
                    <asp:ListItem>table0</asp:ListItem>
                    <asp:ListItem>table1</asp:ListItem>
                </asp:DropDownList>
          
          
                <asp:Button ID="Button1" runat="server" Text="Upload File" Width="100px" 
                    style="margin-left:50px" Height="39px" OnClick="button1_Click"/>
    </p>
          
              </div>
    <p align="left" style="height: 70px">
                <asp:Label ID="Label4" runat="server" BorderColor="Black" 
            BorderStyle="None" BorderWidth="5px" Font-Bold="True" Font-Size="Larger" 
            ForeColor="Black" Height="25px" Width="485px"></asp:Label>
    </p>
    </form>
</body>
</html>

































using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Drawing;
using System.Linq;
using System.Text;
using System.IO;
using System.Windows.Forms;
using System.Data.OleDb;
using System.Data.SqlClient;

namespace WebApplication1
{
    public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {


        }


        protected void button1_Click(object sender, EventArgs e)
        {



            string path = string.Concat(Server.MapPath("~/Uploaded Folder/" + FileUpload1.FileName));
            FileUpload1.SaveAs(path);

            SqlConnection conn2 = new SqlConnection("Data Source =.; Initial catalog=testExcel;integrated security=true");

            string myexceldataquery = "select * from [" + txtSheetname.Text + "$]";


            string PathConn = string.Format("Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + path + ";Extended properties='Excel 8.0;HDR=False' ");
            OleDbConnection conn = new OleDbConnection(PathConn);


            OleDbCommand oledbcmd = new OleDbCommand(myexceldataquery, conn);



            conn.Open();
            OleDbDataReader dr = oledbcmd.ExecuteReader();
            conn.Close();
            



            try
            {
                
                string tablename = DropDownList1.Text;

                SqlBulkCopy bulkcopy = new SqlBulkCopy(conn2);
                bulkcopy.DestinationTableName = tablename;
                conn2.Open();
                conn.Open();
                dr = oledbcmd.ExecuteReader();
               
                bulkcopy.WriteToServer(dr);

                dr.Close();
                conn2.Close();
                conn.Close();

                Label4.Text="Excel Sheet uploaded to " + DropDownList1.Text + ".";
               
            }

            catch(Exception ex)
            {
                Label4.Text = ex.Message;
            }
            finally
            {
                dr.Close();
                conn2.Close();
                conn.Close();

            }
        }

    }
  
}

    

